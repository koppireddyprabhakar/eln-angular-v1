<main id="main" class="main body-height">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">TEST REQUEST FORM</h5>
      <form class="row g-3" [formGroup]="testRequestForm">
        <div class="col-4">
          <label for="testRequestId" class="form-label">Test Request ID</label>
          <input type="text" class="form-control" id="testRequestId" formControlName="testRequestId" readonly />
          <span *ngIf="
              testRequestForm.controls['testRequestId'].invalid &&
              (testRequestForm.controls['testRequestId'].dirty ||
                testRequestForm.controls['testRequestId'].touched) &&
              testRequestForm.get('testRequestId')?.errors &&
              testRequestForm.get('testRequestId')?.hasError('required')
            " class="text-danger">
            Please enter Test Request ID
          </span>
        </div>

        <div class="col-4">
          <label for="department" class="form-label">Department</label>
          <input type="text" class="form-control" id="department" formControlName="department" readonly />
          <span *ngIf="
              testRequestForm.controls['department'].invalid &&
              (testRequestForm.controls['department'].dirty ||
                testRequestForm.controls['department'].touched) &&
              testRequestForm.get('department')?.errors &&
              testRequestForm.get('department')?.hasError('required')
            " class="text-danger">
            Please enter Department
          </span>
        </div>
        <div class="col-4">
          <label for="dosageForm" class="form-label">Dosage Form</label>
          <input type="text" class="form-control" id="dosageForm" formControlName="dosageForm" readonly />
          <span *ngIf="
              testRequestForm.controls['dosageForm'].invalid &&
              (testRequestForm.controls['dosageForm'].dirty ||
                testRequestForm.controls['dosageForm'].touched) &&
              testRequestForm.get('dosageForm')?.errors &&
              testRequestForm.get('dosageForm')?.hasError('required')
            " class="text-danger">
            Please enter dosage form
          </span>
        </div>
        <div class="col-4">
          <label for="projectName" class="form-label">Project Name</label>
          <input type="text" class="form-control" id="projectName" formControlName="projectName" readonly />
          <span *ngIf="
              testRequestForm.controls['projectName'].invalid &&
              (testRequestForm.controls['projectName'].dirty ||
                testRequestForm.controls['projectName'].touched) &&
              testRequestForm.get('projectName')?.errors &&
              testRequestForm.get('projectName')?.hasError('required')
            " class="text-danger">
            Please enter Project Name
          </span>
        </div>
        <div class="col-4">
          <label for="productCode" class="form-label">Product Code</label>
          <input type="text" class="form-control" id="productCode" formControlName="productCode" readonly />
          <span *ngIf="
              testRequestForm.controls['productCode'].invalid &&
              (testRequestForm.controls['productCode'].dirty ||
                testRequestForm.controls['productCode'].touched) &&
              testRequestForm.get('productCode')?.errors &&
              testRequestForm.get('productCode')?.hasError('required')
            " class="text-danger">
            Please enter Product Code
          </span>
        </div>
        <div class="col-4">
          <label for="strength" class="form-label">Strength</label>
          <input type="text" class="form-control" id="strength" formControlName="strength" readonly />
          <span *ngIf="
              testRequestForm.controls['strength'].invalid &&
              (testRequestForm.controls['strength'].dirty ||
                testRequestForm.controls['strength'].touched) &&
              testRequestForm.get('strength')?.errors &&
              testRequestForm.get('strength')?.hasError('required')
            " class="text-danger">
            Please enter Strength
          </span>
        </div>
        <div class="col-4">
          <label for="batchNumber" class="form-label">Batch Number</label>
          <input type="text" class="form-control" id="batchNumber" formControlName="batchNumber" readonly />
          <span *ngIf="
              testRequestForm.controls['batchNumber'].invalid &&
              (testRequestForm.controls['batchNumber'].dirty ||
                testRequestForm.controls['batchNumber'].touched) &&
              testRequestForm.get('batchNumber')?.errors &&
              testRequestForm.get('batchNumber')?.hasError('required')
            " class="text-danger">
            Please enter Batch Number
          </span>
        </div>
        <div class="col-4">
          <label for="condition" class="form-label">Condition</label>
          <input type="text" class="form-control" id="condition" formControlName="condition" />
          <span *ngIf="
              testRequestForm.controls['condition'].invalid &&
              (testRequestForm.controls['condition'].dirty ||
                testRequestForm.controls['condition'].touched) &&
              testRequestForm.get('condition')?.errors &&
              testRequestForm.get('condition')?.hasError('required')
            " class="text-danger">
            Please enter Condition
          </span>
        </div>
        <div class="col-4">
          <label for="stage" class="form-label">Stage</label>
          <input type="text" class="form-control" id="stage" formControlName="stage" />
          <span *ngIf="
              testRequestForm.controls['stage'].invalid &&
              (testRequestForm.controls['stage'].dirty ||
                testRequestForm.controls['stage'].touched) &&
              testRequestForm.get('stage')?.errors &&
              testRequestForm.get('stage')?.hasError('required')
            " class="text-danger">
            Please enter Stage
          </span>
        </div>
        <div class="col-4">
          <label for="packaging" class="form-label">Packaging</label>
          <input type="text" class="form-control" id="packaging" formControlName="packaging" />
          <span *ngIf="
              testRequestForm.controls['packaging'].invalid &&
              (testRequestForm.controls['packaging'].dirty ||
                testRequestForm.controls['packaging'].touched) &&
              testRequestForm.get('packaging')?.errors &&
              testRequestForm.get('packaging')?.hasError('required')
            " class="text-danger">
            Please enter Packaging
          </span>
        </div>
        <div class="col-4">
          <label for="batchSize" class="form-label">Batch size</label>
          <input type="text" class="form-control" id="batchSize" formControlName="batchSize" readonly />
          <span *ngIf="
              testRequestForm.controls['batchSize'].invalid &&
              (testRequestForm.controls['batchSize'].dirty ||
                testRequestForm.controls['batchSize'].touched) &&
              testRequestForm.get('batchSize')?.errors &&
              testRequestForm.get('batchSize')?.hasError('required')
            " class="text-danger">
            Please enter Batch Size
          </span>
        </div>
        <div class="col-4">
          <label for="quantity" class="form-label">Quantity</label>
          <input type="number" class="form-control" id="quantity" formControlName="quantity" />

          <span *ngIf="
              testRequestForm.controls['quantity'].invalid &&
              (testRequestForm.controls['quantity'].dirty ||
                testRequestForm.controls['quantity'].touched) &&
              testRequestForm.get('quantity')?.errors &&
              testRequestForm.get('quantity')?.hasError('required')
            " class="text-danger">
            Please enter Quantity
          </span>
        </div>
        <div class="col-4">
          <label for="labelClaim" class="form-label">Label Claim</label>
          <input type="text" class="form-control" id="labelClaim" formControlName="labelClaim" />

          <span *ngIf="
              testRequestForm.controls['labelClaim'].invalid &&
              (testRequestForm.controls['labelClaim'].dirty ||
                testRequestForm.controls['labelClaim'].touched) &&
              testRequestForm.get('labelClaim')?.errors &&
              testRequestForm.get('labelClaim')?.hasError('required')
            " class="text-danger">
            Please enter Label Claim
          </span>
        </div>
        <div class="col-4">
          <label for="manufacturingDate" class="form-label">Manufacturing Date</label>
          <input type="date" class="form-control" id="manufacturingDate" formControlName="manufacturingDate" />
          <span *ngIf="
              testRequestForm.controls['manufacturingDate'].invalid &&
              (testRequestForm.controls['manufacturingDate'].dirty ||
                testRequestForm.controls['manufacturingDate'].touched) &&
              testRequestForm.get('manufacturingDate')?.errors &&
              testRequestForm.get('manufacturingDate')?.hasError('required')
            " class="text-danger">
            Please enter Manufacturing Date
          </span>
        </div>

        <div class="col-4">
          <label for="expiryDate" class="form-label">Expiry Date</label>
          <input type="date" class="form-control" id="expiryDate" formControlName="expiryDate" />
          <span *ngIf="
              testRequestForm.controls['expiryDate'].invalid &&
              (testRequestForm.controls['expiryDate'].dirty ||
                testRequestForm.controls['expiryDate'].touched) &&
              testRequestForm.get('expiryDate')?.errors &&
              testRequestForm.get('expiryDate')?.hasError('required')
            " class="text-danger">
            Please enter Expiry Date
          </span>
        </div>

        <div class="col-4">
          <label for="purpose" class="form-label">Choose Your Purpose</label>
          <select class="form-select" aria-label="Purpose" formControlName="purpose">
            <option *ngFor="let purpose of purposeList" [ngValue]="purpose.value">
              {{purpose.label | titlecase }}
            </option>
          </select>
          <span *ngIf="
              testRequestForm.controls['purpose'].invalid &&
              (testRequestForm.controls['purpose'].dirty ||
                testRequestForm.controls['purpose'].touched) &&
              testRequestForm.get('purpose')?.errors &&
              testRequestForm.get('purpose')?.hasError('required')
            " class="text-danger">
            Please Choose Your Purpose
          </span>
        </div>   

        <h3>Tests Required</h3>

        <div class="pb-3">
          <ng-multiselect-dropdown [settings]="dropdownSettings" [data]="tests" [(ngModel)]="selectedItems"
            (onSelect)="onItemSelect($event)" (onSelectAll)="onSelectAll($event)" (onDeSelect)="deselect($event)">
          </ng-multiselect-dropdown>
        </div>
        <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="row-border hover pt-4">
          <thead>
            <tr>
              <th>Test Id</th>
              <th>Test Name</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of tableData" class="py-2">
              <td>{{ user.testNumber }}</td>
              <td>{{ user.testName }}</td>
            </tr>
          </tbody>
        </table>
        <div class="text-center pt-4">
          <button type="button" class="btn btn-secondary" (click)="redirectToExperiments()" #closeButton>
            Close
          </button>
          &nbsp;&nbsp;&nbsp;
          <button type="button" class="btn btn-primary" (click)="saveTestRequestForm()">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</main>