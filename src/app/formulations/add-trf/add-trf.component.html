<main id="main" class="main body-height">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">TEST REQUEST FORM</h5>
      <form class="row g-3" [formGroup]="testRequestForm">
        <div class="col-4">
          <label for="testRequestId" class="form-label">Test Request ID</label>
          <input
            type="text"
            class="form-control"
            id="testRequestId"
            formControlName="testRequestId"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['testRequestId'].invalid &&
              (testRequestForm.controls['testRequestId'].dirty ||
                testRequestForm.controls['testRequestId'].touched) &&
              testRequestForm.get('testRequestId')?.errors &&
              testRequestForm.get('testRequestId')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Test Request ID
          </span>
        </div>

        <div class="col-4">
          <label for="department" class="form-label">Department</label>
          <input
            type="text"
            class="form-control"
            id="department"
            formControlName="department"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['department'].invalid &&
              (testRequestForm.controls['department'].dirty ||
                testRequestForm.controls['department'].touched) &&
              testRequestForm.get('department')?.errors &&
              testRequestForm.get('department')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Department
          </span>
        </div>
        <div class="col-4">
          <label for="dosageForm" class="form-label">Dosage Form</label>
          <input
            type="text"
            class="form-control"
            id="dosageForm"
            formControlName="dosageForm"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['dosageForm'].invalid &&
              (testRequestForm.controls['dosageForm'].dirty ||
                testRequestForm.controls['dosageForm'].touched) &&
              testRequestForm.get('dosageForm')?.errors &&
              testRequestForm.get('dosageForm')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter dosage form
          </span>
        </div>
        <div class="col-4">
          <label for="projectName" class="form-label">Project Name</label>
          <input
            type="text"
            class="form-control"
            id="projectName"
            formControlName="projectName"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['projectName'].invalid &&
              (testRequestForm.controls['projectName'].dirty ||
                testRequestForm.controls['projectName'].touched) &&
              testRequestForm.get('projectName')?.errors &&
              testRequestForm.get('projectName')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Project Name
          </span>
        </div>
        <div class="col-4">
          <label for="projectCode" class="form-label">Project Code</label>
          <input
            type="text"
            class="form-control"
            id="projectCode"
            formControlName="projectCode"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['projectCode'].invalid &&
              (testRequestForm.controls['projectCode'].dirty ||
                testRequestForm.controls['projectCode'].touched) &&
              testRequestForm.get('projectCode')?.errors &&
              testRequestForm.get('projectCode')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Project Code
          </span>
        </div>
        <div class="col-4">
          <label for="strength" class="form-label">Strength</label>
          <input
            type="text"
            class="form-control"
            id="strength"
            formControlName="strength"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['strength'].invalid &&
              (testRequestForm.controls['strength'].dirty ||
                testRequestForm.controls['strength'].touched) &&
              testRequestForm.get('strength')?.errors &&
              testRequestForm.get('strength')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Strength
          </span>
        </div>
        <div class="col-4">
          <label for="batchNumber" class="form-label">Batch Number</label>
          <input
            type="text"
            class="form-control"
            id="batchNumber"
            formControlName="batchNumber"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['batchNumber'].invalid &&
              (testRequestForm.controls['batchNumber'].dirty ||
                testRequestForm.controls['batchNumber'].touched) &&
              testRequestForm.get('batchNumber')?.errors &&
              testRequestForm.get('batchNumber')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Batch Number
          </span>
        </div>
        <div class="col-4">
          <label for="condition" class="form-label">Condition</label>
          <input
            type="text"
            class="form-control"
            id="condition"
            formControlName="condition"
          />
          <span
            *ngIf="
              testRequestForm.controls['condition'].invalid &&
              (testRequestForm.controls['condition'].dirty ||
                testRequestForm.controls['condition'].touched) &&
              testRequestForm.get('condition')?.errors &&
              testRequestForm.get('condition')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Condition
          </span>
        </div>
        <div class="col-4">
          <label for="stage" class="form-label">Stage</label>
          <input
            type="text"
            class="form-control"
            id="stage"
            formControlName="stage"
          />
          <span
            *ngIf="
              testRequestForm.controls['stage'].invalid &&
              (testRequestForm.controls['stage'].dirty ||
                testRequestForm.controls['stage'].touched) &&
              testRequestForm.get('stage')?.errors &&
              testRequestForm.get('stage')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Stage
          </span>
        </div>
        <div class="col-4">
          <label for="packaging" class="form-label">Packaging</label>
          <input
            type="text"
            class="form-control"
            id="packaging"
            formControlName="packaging"
          />
          <span
            *ngIf="
              testRequestForm.controls['packaging'].invalid &&
              (testRequestForm.controls['packaging'].dirty ||
                testRequestForm.controls['packaging'].touched) &&
              testRequestForm.get('packaging')?.errors &&
              testRequestForm.get('packaging')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Packaging
          </span>
        </div>
        <div class="col-4">
          <label for="batchSize" class="form-label">Batch size</label>
          <input
            type="text"
            class="form-control"
            id="batchSize"
            formControlName="batchSize"
            readonly
          />
          <span
            *ngIf="
              testRequestForm.controls['batchSize'].invalid &&
              (testRequestForm.controls['batchSize'].dirty ||
                testRequestForm.controls['batchSize'].touched) &&
              testRequestForm.get('batchSize')?.errors &&
              testRequestForm.get('batchSize')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Batch Size
          </span>
        </div>
        <div class="col-4">
          <label for="quantity" class="form-label">Quantity</label>
          <input
            type="number"
            class="form-control"
            id="quantity"
            formControlName="quantity"
          />

          <span
            *ngIf="
              testRequestForm.controls['quantity'].invalid &&
              (testRequestForm.controls['quantity'].dirty ||
                testRequestForm.controls['quantity'].touched) &&
              testRequestForm.get('quantity')?.errors &&
              testRequestForm.get('quantity')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Quantity
          </span>
        </div>
        <div class="col-4">
          <label for="labelClaim" class="form-label">Label Claim</label>
          <input
            type="text"
            class="form-control"
            id="labelClaim"
            formControlName="labelClaim"
          />

          <span
            *ngIf="
              testRequestForm.controls['labelClaim'].invalid &&
              (testRequestForm.controls['labelClaim'].dirty ||
                testRequestForm.controls['labelClaim'].touched) &&
              testRequestForm.get('labelClaim')?.errors &&
              testRequestForm.get('labelClaim')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Label Claim
          </span>
        </div>
        <div class="col-4">
          <label for="manufacturingDate" class="form-label"
            >Manufacturing Date</label
          >
          <input
            type="date"
            class="form-control"
            id="manufacturingDate"
            formControlName="manufacturingDate"
          />
          <span
            *ngIf="
              testRequestForm.controls['manufacturingDate'].invalid &&
              (testRequestForm.controls['manufacturingDate'].dirty ||
                testRequestForm.controls['manufacturingDate'].touched) &&
              testRequestForm.get('manufacturingDate')?.errors &&
              testRequestForm.get('manufacturingDate')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Manufacturing Date
          </span>
        </div>

        <div class="col-4">
          <label for="expiryDate" class="form-label">Expiry Date</label>
          <input
            type="date"
            class="form-control"
            id="expiryDate"
            formControlName="expiryDate"
          />
          <span
            *ngIf="
              testRequestForm.controls['expiryDate'].invalid &&
              (testRequestForm.controls['expiryDate'].dirty ||
                testRequestForm.controls['expiryDate'].touched) &&
              testRequestForm.get('expiryDate')?.errors &&
              testRequestForm.get('expiryDate')?.hasError('required')
            "
            class="text-danger"
          >
            Please enter Expiry Date
          </span>
        </div>
        <!-- <div class="col-12">
          <section formArrayName="testRequestRow">
            <div
              *ngFor="let testRow of testRequestRow?.controls; let i = index"
              [formGroupName]="i"
              class="formultion-row row"
            >
              <div
                [ngClass]="{
                  'col-4': testRequestRow.value.length === 1,
                  'col-3': testRequestRow.value.length > 1
                }"
              >
                <label class="col-sm-2 col-form-label">Id</label>

                <input
                  type="text"
                  class="form-control"
                  id="testId"
                  formControlName="testId"
                  readonly
                />
              </div>
              <div class="col-4">
                <label class="col-sm-2 col-form-label">Test</label>

                <input
                  type="text"
                  class="form-control"
                  id="testName"
                  formControlName="testName"
                />
              </div>
              <div class="col-4">
                <label class="col-sm-2 col-form-label">Results</label>

                <input
                  type="text"
                  class="form-control"
                  id="testResult"
                  formControlName="testResult"
                />
              </div>
              <div *ngIf="testRequestRow.value.length > 1" class="col-1 pt-3">
                <div for="description" class="form-label">&nbsp;</div>
                <div class="delete-formulation">
                  <i class="bi bi-trash-fill pointer delete-icon"></i>
                </div>
              </div>
            </div>
          </section>
          <div class="add-formulation pt-4">
            <i class="bi bi-plus-circle pointer"></i
            ><span class="pointer" (click)="addNewTest()">Add Test</span>
          </div>
        </div> -->

        <h3>Lab Tests</h3>

        <div class="pb-3">
          <ng-multiselect-dropdown
            [settings]="dropdownSettings"
            [data]="tests"
            [(ngModel)]="selectedItems"
            (onSelect)="onItemSelect($event)"
            (onSelectAll)="onSelectAll($event)"
            (onDeSelect)="deselect($event)"
          >
          </ng-multiselect-dropdown>
        </div>

        <div class="tableNgx">
          <ngx-datatable
            tableClass="table table-striped table-bordered table-hover tableNgx"
            [data]="tableData"
            [options]="options"
            [columns]="columns"
          >
          </ngx-datatable>
        </div>
        <div class="text-center pt-4">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="redirectToUsers()"
            #closeButton
          >
            Close
          </button>
          &nbsp;&nbsp;&nbsp;
          <button
            type="button"
            class="btn btn-primary"
            (click)="saveTestRequestForm()"
          >
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</main>
