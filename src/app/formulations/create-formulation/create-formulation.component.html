<main id="main" class="main body-height">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <ul class="nav nav-tabs outer-tab-border pt-4" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" [ngClass]="{ active: activeTab === 'summary' }" id="summary-tab"
              data-bs-toggle="tab" data-bs-target="#summary" (click)="search('summary', -1)" type="button" role="tab"
              aria-controls="summary" aria-selected="false">
              Summary
            </button>
          </li>
          <li class="nav-item" role="presentation" *ngFor="let dumm of dummyTabs; index as i">
            <button *ngIf="!dumm.isEdit" class="nav-link" id="{{ dumm.value }}-tab" [disabled]="!isCreatedExperiment"
              data-bs-toggle="tab" [attr.data-bs-target]="'#' + dumm.value" type="button" role="tab"
              (click)="search(dumm.value, i)" [ngClass]="{ active: activeTab === dumm.value }"
              [attr.aria-controls]="dumm.value" aria-selected="true">
              {{ dumm.label }}
              <i class="bi bi-pencil-square" *ngIf="isCreatedExperiment" (click)="editMode(i)"></i>
              <!-- <span >Edit</span> -->
            </button>

            <input *ngIf="dumm.isEdit" [(ngModel)]="inputValue" type="text" class="form-control"
              (blur)="resetEditMode(i, dumm.label)" #inputfields autofocus="true" />
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="contact-tab" [disabled]="!isCreatedExperiment" data-bs-toggle="tab"
              data-bs-target="#contact" (click)="search('excipients', -1)"
              [ngClass]="{ active: activeTab === 'contact' }" type="button" role="tab" aria-controls="contact"
              aria-selected="false">
              Excipients/Chemicals
            </button>
          </li>
          <li
            *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Analysis Submitted'.toUpperCase())"
            class="nav-item" role="presentation">
            <button class="nav-link" id="results-tab" [disabled]="!isCreatedExperiment" data-bs-toggle="tab"
              data-bs-target="#results" (click)="search('results', -1)" [ngClass]="{ active: activeTab === 'results' }"
              type="button" role="tab" aria-controls="results" aria-selected="false">
              Results
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="attachments-tab" [disabled]="!isCreatedExperiment" data-bs-toggle="tab"
              data-bs-target="#attachments" (click)="search('attachments', -1)"
              [ngClass]="{ active: activeTab === 'attachments' }" type="button" role="tab" aria-controls="attachments"
              aria-selected="false">
              Attachments
            </button>
          </li>
          <li class="nav-item" role="presentation" *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() ||
            experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())">
            <button class="nav-link" id="attachments-tab" [disabled]="!isCreatedExperiment" type="button"
              (click)="addNew()">
              Add New Tab
            </button>
          </li>
          <!-- <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="profile-tab"
              data-bs-toggle="tab"
              data-bs-target="#profile"
              type="button"
              role="tab"
              aria-controls="profile"
              aria-selected="false"
            >
              Profile
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="contact-tab"
              data-bs-toggle="tab"
              data-bs-target="#contact"
              type="button"
              role="tab"
              aria-controls="contact"
              aria-selected="false"
            >
              Contact
            </button>
          </li> -->
        </ul>
        <div class="tab-content pt-2" id="myTabContent">
          <div class="tab-pane fade show" [ngClass]="{
              active: activeTab === 'summary',
              show: activeTab === 'summary'
            }" id="summary" role="tabpanel" aria-labelledby="summary-tab">
            <div>
              <!-- <h4 class="pt-2">Details of the experiment</h4> -->
              <div class="row pt-3">
                <div class="col-lg-12">
                  <div class="card">
                    <div class="card-body" *ngIf="project">
                      <h5 class="card-title">Details of the experiment</h5>
                      <form class="row g-3" [formGroup]="summaryForm">
                        <div class="row mb-3 pt-2">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Project Name</label>
                          <div class="col-sm-9 pt-1">
                            {{ project.projectName }}
                          </div>
                        </div>
                        <div class="row mb-3 pt-2">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Product Name</label>
                          <div class="col-sm-9 pt-1">
                            {{ project.productName }}
                          </div>
                        </div>
                        <div class="row mb-3 pt-2">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Product Code</label>
                          <div class="col-sm-9 pt-1">
                            {{ project.productCode }}
                          </div>
                        </div>
                        <div class="row mb-3 pt-2">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Dosage Name</label>
                          <div class="col-sm-9 pt-1">
                            {{ project.dosageName }}
                          </div>
                        </div>
                        <!-- <input class="form-control" type="text"  /> -->
                        <div class="row mb-3">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Formulation Type</label>
                          <div class="col-sm-9 pt-1">
                            {{ project.formulationName }}
                          </div>
                        </div>
                        <div class="row mb-3">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Batch Number</label>
                          <div class="col-sm-9 pt-1">{{ batchNumber }}</div>
                        </div>

                        <div class="row mb-3">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Start Date</label>
                          <div class="col-sm-9 pt-1">{{ (experimentDetails && experimentDetails.expStartDate ||
                            startDate.toLocaleDateString())
                            | date:'medium'  }}</div>
                        </div>

                        <div class="row mb-3" *ngIf="(experimentDetails && experimentDetails.analysisSubmitDate)">
                          <label for="inputEmail3" class="col-sm-3 col-form-label">Analysis Submitted Date</label>
                          <div class="col-sm-9 pt-1">{{ (experimentDetails && experimentDetails.analysisSubmitDate) |
                            date }}</div>
                        </div>

                        <div class="row mb-3">
                          <label for="experimentName" class="col-sm-3 col-form-label">Experiment Name</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="experimentName"
                              formControlName="experimentName" />
                            <span *ngIf="
                              summaryForm.controls['experimentName'].invalid &&
                               (summaryForm.controls['experimentName'].dirty ||
                               summaryForm.controls['experimentName'].touched) &&
                               summaryForm.get('experimentName')?.errors &&
                               summaryForm.get('experimentName')?.hasError('required')
                              " class="text-danger">
                              Please enter Experiment Name
                            </span>
                          </div>
                        </div>
                        <!-- <div class="row mb-3">
                        <label for="inputEmail3" class="col-sm-3 col-form-label"
                          >Product Name</label
                        >
                        <div class="col-sm-9 pt-1">Random Name</div>
                      </div> -->
                        <div class="row mb-3">
                          <label for="batchSize" class="col-sm-3 col-form-label">Batch Size</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="batchSize"  [readonly]="experimentId" formControlName="batchSize" />
                            <span *ngIf="
                              summaryForm.controls['batchSize'].invalid &&
                               (summaryForm.controls['batchSize'].dirty ||
                               summaryForm.controls['batchSize'].touched) &&
                               summaryForm.get('batchSize')?.errors &&
                               summaryForm.get('batchSize')?.hasError('required')
                              " class="text-danger">
                              Please enter BatchSize
                            </span>
                          </div>
                        </div>
                      </form>
                      <div class="text-center" *ngIf="!experimentId">
                        <button type="submit" class="btn btn-primary" (click)="saveSummary()">
                          Start Experiment
                        </button>
                      </div>

                      <div class="text-center" *ngIf="experimentId && experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() || 
                      experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())">
                        <button type="submit" class="btn btn-primary" (click)="updateSummary()">
                          Update Experiment
                        </button>
                      </div>

                      <!-- <div class="row mb-3">
                        <label for="inputEmail3" class="col-sm-3 col-form-label"
                          >Product Code</label
                        >
                        <div class="col-sm-9 pt-1">Random Name</div>
                      </div> -->
                      <!-- <div class="row mb-3">
                        <label for="inputEmail3" class="col-sm-3 col-form-label"
                          >Dosage Name</label
                        >
                        <div class="col-sm-9 pt-1">Random Name</div>
                      </div>
                      <div class="row mb-3">
                        <label for="inputEmail3" class="col-sm-3 col-form-label"
                          >Formulation Type</label
                        >
                        <div class="col-sm-9 pt-1">Random Name</div>
                      </div>
                      <div class="row mb-3">
                        <label for="inputEmail3" class="col-sm-3 col-form-label"
                          >Strength</label
                        >
                        <div class="col-sm-9 pt-1">Random Name</div>
                      </div>
                      <div class="row mb-3">
                        <label for="inputEmail3" class="col-sm-3 col-form-label"
                          >Formulation Department</label
                        >
                        <div class="col-sm-9 pt-1">Random Name</div>
                      </div> -->
                      <!-- <div class="text-center">
                        <button type="submit" class="btn btn-primary">
                          Submit
                        </button>
                        <button type="reset" class="btn btn-secondary">
                          Reset
                        </button>
                      </div> -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- <section > -->
          <div *ngFor="let dumm of dummyTabs; index as i" class="tab-pane fade" [ngClass]="{
              active: activeTab === dumm.value,
              show: activeTab === dumm.value
            }" id="{{ dumm.value }}" role="tabpanel" [attr.aria-labelledby]="dumm + '-tab'">
            <ckeditor required [(ngModel)]="article[i].text" data="" name="text"></ckeditor>
            <!-- <ckeditor data="<p>Hello, world!</p>"></ckeditor> -->
            <div class="text-center pt-3">
              <button type="submit" class="btn btn-primary" *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() || 
                experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())"
                (click)="saveTab(i, dumm)">
                Save
              </button>
            </div>
          </div>

          <!-- </section> -->
          <div class="tab-pane fade" [ngClass]="{
              active: activeTab === 'contact',
              show: activeTab === 'contact'
            }" id="contact" role="tabpanel" aria-labelledby="contact-tab">
            <div class="pt-3 pb-3">
              <ng-multiselect-dropdown [settings]="dropdownSettings" [data]="inwards" [(ngModel)]="selectedItems"
                (onSelect)="onItemSelect($event)" (onSelectAll)="onSelectAll($event)" (onDeSelect)="deselect($event)">
              </ng-multiselect-dropdown>
            </div>
            <table id="first-table" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="row-border hover">
              <thead>
                <tr>
                  <th>Inward Name</th>
                  <th>Material Name</th>
                  <th>Material Type</th>
                  <th>Batch Number</th>
                  <th>Source Name</th>
                  <th>Potency</th>
                  <th>Grade</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of tableData">
                  <td>{{ user.excipientsName }}</td>
                  <td>{{ user.materialName }}</td>
                  <td>{{ user.materialType }}</td>
                  <td>{{ user.batchNo }}</td>
                  <td>{{ user.sourceName }}</td>
                  <td>{{ user.potency }}</td>
                  <td>{{ user.grade }}</td>
                </tr>
              </tbody>
            </table>
            <div class="text-center pt-3">
              <button type="submit" class="btn btn-primary mt-3" *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() || 
                experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())"
                (click)="saveExcipients()">
                Save
              </button>
            </div>
          </div>
          <div
            *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Analysis Submitted'.toUpperCase())"
            class="tab-pane fade" [ngClass]="{
                        active: activeTab === 'results',
                        show: activeTab === 'results'
                      }" id="results" role="tabpanel" aria-labelledby="results-tab">

            <h3>RESULTS</h3>

            <table id="second-table" datatable [dtOptions]="dtResultOptions" [dtTrigger]="dtResultTrigger"
              class="row-border hover pt-4">
              <thead>
                <tr>
                  <th>Test Id</th>
                  <th>Test Name</th>
                  <th>Results</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let test of tests" class="py-2">
                  <td>{{ test.testNumber }}</td>
                  <td>{{ test.testName }}</td>
                  <td>{{ test.testResult }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="tab-pane fade" [ngClass]="{
              active: activeTab === 'attachments',
              show: activeTab === 'attachments'
            }" id="attachments" role="tabpanel" aria-labelledby="attachments-tab">
            <div class="row mb-3" *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() || 
              experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())">
              <label for="inputNumber" class="col-sm-2 col-form-label">
                Upload</label>
              <div class="col-sm-10">
                <input class="form-control" type="file" id="formFile" (change)="processFile($event)" />
              </div>
            </div>
            <div class="row mb-3">
              <label *ngIf="files.length > 0">Uploaded Attachements</label>
              <span *ngFor="let file of files">
                <div class="file-container">
                  <span class="file-list" (click)="getFileContent(file.name, file.experimentId)">{{ file.name |
                    titlecase }}</span>
                  <span class="align-right" *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() || 
                    experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())"
                    (click)="removeAttachment(file)">Remove <i class="bi bi-trash-fill pointer"></i></span>
                </div>
              </span>
            </div>

            <!-- COMPLETE BUTTON-->
            <div class="text-center pt-3">
              <button type="submit" *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Inprogress'.toUpperCase() || 
                experimentDetails.experimentStatus.toUpperCase() === 'Need Correction'.toUpperCase())"
                class="btn btn-primary mt-3" (click)="updateExperimentStatus()">
                Complete Formulation
              </button>
            </div>


            <!-- <div class="text-center pt-3">
              <button type="submit"
                *ngIf="experimentDetails && (experimentDetails.experimentStatus.toUpperCase() === 'Complete'.toUpperCase())"
                class="btn btn-primary mt-3" (click)="updateExperimentStatus()">
                Submit
              </button>
            </div> -->

          </div>
        </div>
      </div>
    </div>
  </div>
</main>