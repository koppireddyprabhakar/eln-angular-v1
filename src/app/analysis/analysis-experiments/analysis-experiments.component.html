<main id="main" class="main body-height">
  <div class="pagetitle">
    <h1>Experiments</h1>
  </div>
  <div class="card pt-4">
    <div class="card-body">
      <ul class="nav nav-tabs" id="myTab1" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="allExperiments-tab" data-bs-toggle="tab" data-bs-target="#allExperiments"
            type="button" role="tab" aria-controls="allExperiments" aria-selected="true" (click)="getExperiments()">
            All Experiments
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="myExperiments-tab" data-bs-toggle="tab" data-bs-target="#myExperiments"
            type="button" role="tab" aria-controls="myExperiments" aria-selected="false" (click)="getMyExperiments()">
            My Experiments
          </button>
        </li>
      </ul>
      <div class="tab-content inner-card" id="myTab1Content">
        <div class="tab-pane fade show active pt-4" id="allExperiments" role="tabpanel"
          aria-labelledby="allExperiments-tab">
          <table id="first-table" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="row-border hover">
            <thead>
              <tr>
                <th>S.No</th>
                <th>Analysis Exp Name</th>
                <th>Project&nbsp;Name</th>
                <th>Batch Size</th>
                <!-- <th>Project ID</th> -->
                <th>Formulation</th>
                <th>Creation Date</th>
                <th>Strength</th>
                <th>Status</th>
                <th>Options</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let experiment of experiments; let i = index">
                <td>{{i + 1}}</td>
                <td>{{ experiment.analysisName }}</td>
                <td>{{ experiment.project.projectName }}</td>
                <td>{{ experiment.batchSize }}</td>
                <!-- <td>{{ experiment.projectId }}</td> -->
                <td>
                  {{ experiment.project && experiment.project.formulationName }}
                </td>
                <td>{{ experiment.insertDate}}</td>
                <td>{{ experiment.project && experiment.project.strength }}</td>
                <td>{{ experiment.status }}</td>
                <td><i (click)="viewAnalysisExperiment(experiment)" class="viewIcon bi-eye-fill">
                  </i></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="tab-pane fade pt-4" id="myExperiments" role="tabpanel" aria-labelledby="myExperiments-tab">
          <table id="second-table" datatable [dtOptions]="dtMyProjectsOptions" [dtTrigger]="dtMyProjectsTrigger"
            class="row-border hover">
            <thead>
              <tr>
                <th>S.No</th>
                <th>Analysis Exp Name</th>
                <th>Project&nbsp;Name</th>
                <th>Batch Size</th>
                <!-- <th>Project ID</th> -->
                <th>Formulation</th>
                <th>Creation Date</th>
                <th>Strength</th>
                <th>Status</th>
                <th>Options</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let experiment of myExperiments; let i = index">
                <td>{{i + 1}}</td>
                <td>{{ experiment.analysisName }}</td>
                <td>{{ experiment.project.projectName }}</td>
                <td>{{ experiment.batchSize }}</td>
                <!-- <td>{{ experiment.projectId }}</td> -->
                <td>
                  {{ experiment.project && experiment.project.formulationName }}
                </td>
                <td>{{ experiment.insertDate}}</td>
                <td>{{ experiment.project && experiment.project.strength }}</td>
                <td>{{ experiment.status }}</td>
                <td>
                  <!-- <i (click)="onRowClick(experiment)" class="editIcon ri-edit-2-fill"></i> -->
                  <i *ngIf="experiment.status.toUpperCase() ===
                             'Inprogress'.toUpperCase() || experiment.status.toUpperCase() ===
                             'Need Correction'.toUpperCase()" (click)="onRowClick(experiment)"
                    class="editIcon ri-edit-2-fill">
                  </i>
                  <i *ngIf="experiment.status.toUpperCase() !==
                    'Inprogress'.toUpperCase() && experiment.status.toUpperCase() !==
                    'Need Correction'.toUpperCase()" (click)="onRowClick(experiment)" class="viewIcon bi-eye-fill">
                  </i>
                  &nbsp;&nbsp;
                  <i *ngIf="experiment && experiment.status === 'Complete'" data-bs-toggle="modal"
                    data-bs-target="#reviewSubmitForms" (click)="selectUser(experiment)"
                    class="tertiaryIcon bi bi-person-badge"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Review Form -->
<div class="modal fade" id="reviewSubmitForms" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reviewer Form</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form class="row g-3" [formGroup]="reviewSubmitForm">
          <div class="col-12">
            <label for="userId" class="form-label">Reviewer Name</label>
            <select class="form-select" aria-label="Role Id" formControlName="userId">
              <option *ngFor="let userRole of users" [ngValue]="userRole.userId">
                {{ userRole.firstName + " " + userRole.lastName | titlecase }}
              </option>
            </select>
            <span *ngIf="
                reviewSubmitForm.controls['userId'].invalid &&
                (reviewSubmitForm.controls['userId'].dirty ||
                  reviewSubmitForm.controls['userId'].touched) &&
                reviewSubmitForm.get('userId')?.errors &&
                reviewSubmitForm.get('userId')?.hasError('required')
              " class="text-danger">
              Please select Reviewer Name
            </span>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" #closeButton>
          Close
        </button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="submitReview()">
          Submit Review
        </button>
      </div>
    </div>
  </div>
</div>

<!-- End-->